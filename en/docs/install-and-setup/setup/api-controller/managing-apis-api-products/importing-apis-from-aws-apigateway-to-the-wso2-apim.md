# Importing APIs from AWS API Gateway to the WSO2 API Manager 

## Introduction

`aws init` is a apictl command which will use the AWS CLI in the background to download the OAS of an API from the AWS API Gateway to initialize a WSO2 API Manager project. The user has to provide the name of the AWS API and a specific API Stage. The `aws init` command will be executing two AWS CLI commands in the backgroung to get the OAS of an API.

1. `aws apigateway get-rest-apis` This command will return all the AWS APIs a user has in their AWS account. The `aws init` command will match the API name provided when the `aws init` command was executed and get it's ID to execute the `aws get-export` command.

2. `aws apigateway get-export api-id <api_id> stage-name <stage_name> --export-type oas30 <path>` This command will download the swagger of the API and store it in a temporary directory till the API Manager project is innitialized. After initializing the API Manager project the temporary directory along with the OAS of the AWS API will be deleted.

Then the user can use the `apictl import-api` command to import the initialized project as an API to the WSO2 API Manager. For more information refer [Import an API project](https://apim.docs.wso2.com/en/latest/learn/api-controller/importing-apis-via-dev-first-approach/#import-an-api-project).

## Prerequisites 

1. Since the `aws init` command uses the AWS CLI the user needs to download and install the AWS CLI. Refer [here](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html).

2. After successfully installing the AWS CLI it needs to be configured. Refer [here](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html).

3. Disable AWS CLI pagination. By default the AWS CLI returns all objects in the output, but if you have disabled pagination you will have to enable pagination for the `aws init` command to successfully work. 
For more information, refer [here](https://docs.aws.amazon.com/cli/latest/userguide/cli-usage-pagination.html).

## Importing an API from AWS Apigateway to the WSO2 API Manager  

Usage of this command is quite simple. Two flags are associated with the `aws init` command, `name` and `stagename`. Both of these flags are mandatory.

-   **Command**

    ``` bash
    apictl aws init --name <aws-api-name> --stagename <api-stage-name>
    ```

    ``` bash
    apictl aws init -n <aws-api-name> -s <api-stage-name>
    ```

!!! example
    ```bash
    apictl aws init --name Shopping --stagename Live
    ```
    ```bash
    apictl aws init -n PetStore -s demo
    ```

!!! info
    **Flags:**  
            
    -    Required :  

        `--name` or `-n` : Name of the API to get from the AWS API Gateway

        `--stagename` or `-s` : API stage to get 

!!! tip
    The API Manager project will be initialized in the same location where the command was executed from. 

-   **Response**
    
    ``` bash tab="Response Format"
    Temporary directory created
    AWS CLI version : 
    <aws-cli-version>

    API ID found: <api-id> {
        "contentType": "application/octet-stream",
        "contentDisposition": "attachment; filename=\"oas30_20xx-xx-00T00:00:00Z.json\""
    }

    Initializing a new WSO2 API Manager project in /<path-to-api-manager-project>
    Project initialized
    Open README file to learn more
    Temporary directory deleted
    ```
    
    ``` bash tab="Example Response"
    Temporary directory created
    AWS CLI version : 
    aws-cli/1.18.121 Python/3.6.9 Linux/4.15.0-118-generic botocore/1.17.44

    API ID found: ern7ceaofh {
        "contentType": "application/octet-stream",
        "contentDisposition": "attachment; filename=\"oas30_2020-07-16T09:48:47Z.json\""
    }

    Initializing a new WSO2 API Manager project in /home/user/Desktop/product-apim-tooling-master/import-export-cli
    Project initialized
    Open README file to learn more
    Temporary directory deleted
    ```

### Importing the initialized API project to the WSO2 API Manager as an API

!!! NOTE
    The initial state of the API will be set to `CREATED`. 

-   **Command**

    ``` bash
    apictl import api -f <path-to-api-project> -e <environment> -k
    ```

!!! example
    ```bash
    apictl import api -f /home/user/Documents/product-apim-tooling/import-export-cli/PetStore -e production -k
    ```

To learn more about importing an API project refer to [import-api-project](https://apim.docs.wso2.com/en/latest/learn/api-controller/importing-apis-via-dev-first-approach/#import-an-api-project).

## Understanding error codes

### 255

One of the most common errors related to this command is the `exit status 255`. This is a AWS CLI error code and it means the AWS CLI command failed and that there were errors generated by the AWS CLI or by the AWS service to which the request was sent.
The most common reason for this is due to a incorrect stage name provided.

!!! tip
    Make sure you provide the correct stage name and the spellings are correct.
    It is also important to remember the name and stagename are case sensitive.

For a more detailed report execute the `aws init` command with the `--verbose` flag. 